#!/bin/bash -x

BINDIR="$(dirname $0)"
ETCDIR="${BINDIR}/../etc"
LIBDIR="${BINDIR}/../lib"

if [[ $# -ne 1 ]]; then
        echo "usage: $0: <input_sof>"
        exit 1
fi

INPUT="$1"

if [[ ! -e "$INPUT" ]]; then
        ls "$INPUT"
        exit 2
fi

IFBN="$(basename ${INPUT})"
IFILE="${IFBN%.sof}"

if [[ "$IFBN" != "${IFILE}.sof" ]]; then
        echo "$INPUT: Must be sof file"
        exit 3
fi


echo "*******************************"
echo "* Step 3: Generate CDF"
echo "*******************************"
echo 

. ${BINDIR}/sofcdfgen "${INPUT}"
CDF="$TOUT"
echo "** CDF=$CDF"

echo "*******************************"
echo "* Step 4: Program JIC to EPCS4"
echo "*******************************"
echo 

set -x
quartus_pgm "$CDF"
set +x

